<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>New England High Points</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      line-height: 1.5;
    }

    h1 {
      text-align: center;
      margin-top: 20px;
    }

    p {
      max-width: 90%;
      margin: 0 auto 20px auto;
      padding: 0 10px;
      font-size: 1.1em;
      line-height: 1.4;
      text-align: center;
    }

    table {
      border-collapse: collapse;
      width: 90%;
      margin: 20px auto;
      font-size: 0.95em;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 6px 10px;
      text-align: center;
    }

    th {
      background-color: #f2f2f2;
    }

    h2 {
      text-align: center;
      margin-top: 40px;
    }
  </style>
</head>
<body>

  <h1>Highest Point in Every Municipality in New England </h1>

  <p>
    This data was created based on 1/3 arc second USGS DEM data (~10 meter resolution) and I will keep updating it over the coming weeks.
  </p>
  <p>
    The What3Words location is approximate because my GPS phone appâ€™s accuracy is about 5 meters.
  </p>
  <p>
    It is expected that this list will take 10 years to complete. Please be patient.  
    If you have a request for a specific municipality, please email me at: ihtftl@gmail.com
  </p>

  <script>
    function openPhotos(photos) {
      // Generate the HTML content with onerror fallback to dummy.jpg
      const content = photos.map(src => `
        <img src="${src}" style="max-width:100%; margin-bottom:10px;" 
            onerror="this.onerror=null;this.src='images/dummy.jpg';" alt="Photo not available">
      `).join('');

      // Open a new tab
      const win = window.open('', '_blank');

      // Write the content into the new tab
      win.document.write(`
        <html>
          <head>
            <title>Photos</title>
            <style>
              body { margin: 10px; font-family: Arial, sans-serif; }
              img { display: block; max-width: 100%; margin-bottom: 10px; }
            </style>
          </head>
          <body>
            ${content}
          </body>
        </html>
      `);
      win.document.close();
    }

    fetch('data.json')
      .then(response => response.json())
      .then(data => {
        // Group by state
        const states = {};
        data.forEach(item => {
          if (!states[item.state]) {
            states[item.state] = [];
          }
          states[item.state].push(item);
        });

        // Sort states alphabetically
        const sortedStates = Object.keys(states).sort();

        sortedStates.forEach(state => {
          // State heading
          const heading = document.createElement('h2');
          heading.textContent = state;
          document.body.appendChild(heading);

          // Create table
          const table = document.createElement('table');
          table.innerHTML = `
            <thead>
              <tr>
                <th>Municipality</th>
                <th>Name</th>
                <th>Latitude</th>
                <th>Longitude</th>
                <th>Height (m)</th>
                <th>Height (ft)</th>
                <th>What3Words</th>
                <th>Photos</th>
              </tr>
            </thead>
            <tbody></tbody>
          `;
          document.body.appendChild(table);

          const tbody = table.querySelector('tbody');

          // Fill table rows
          states[state].forEach(item => {
            const latitude = item.latitude === null ? "Josh will provide soon" : item.latitude.toFixed(4);
            const longitude = item.longitude === null ? "Josh will provide soon" : item.longitude.toFixed(4);
            const height_m = item.height_m === null ? "Josh will provide soon" : item.height_m.toFixed(1);
            const height_ft = item.height_ft === null ? "Josh will provide soon" : item.height_ft.toFixed(1);

            const what3words = item.what3words || "Josh will provide soon";
            const w3wDisplay = what3words;
            const w3wLink = what3words === "Josh will provide soon" 
              ? null 
              : `https://what3words.com/${encodeURIComponent(what3words.replace(/\s+/g, '.'))}`;

            const photosLinks = Array.isArray(item.photos_link) ? item.photos_link : [item.photos_link];
            const photosHtml = `<a href="#" onclick='openPhotos(${JSON.stringify(photosLinks)}); return false;'>Photos</a>`;

            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${item.municipality}</td>
              <td>${item.name}</td>
              <td>${latitude}</td>
              <td>${longitude}</td>
              <td>${height_m}</td>
              <td>${height_ft}</td>
              <td>${w3wLink ? `<a href="${w3wLink}" target="_blank">${w3wDisplay}</a>` : w3wDisplay}</td>
              <td>${photosHtml}</td>
            `;
            tbody.appendChild(row);
          });
        });
      });
  </script>

</body>
</html>
