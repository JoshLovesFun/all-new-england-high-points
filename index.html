<script>
fetch('data.json')
  .then(response => response.json())
  .then(data => {
    // Group by state
    const states = {};
    data.forEach(item => {
      if (!states[item.state]) {
        states[item.state] = [];
      }
      states[item.state].push(item);
    });

    // Sort states alphabetically
    const sortedStates = Object.keys(states).sort();

    const container = document.body;

    sortedStates.forEach(state => {
      // State heading
      const heading = document.createElement('h2');
      heading.textContent = state;
      heading.style.textAlign = "center";
      container.appendChild(heading);

      // Create table
      const table = document.createElement('table');
      table.style.borderCollapse = "collapse";
      table.style.width = "80%";
      table.style.margin = "20px auto";
      table.innerHTML = `
        <thead>
          <tr>
            <th>Municipality</th>
            <th>Name</th>
            <th>Latitude</th>
            <th>Longitude</th>
            <th>Height (m)</th>
            <th>Height (ft)</th>
            <th>What3Words</th>
            <th>Photos</th>
          </tr>
        </thead>
        <tbody></tbody>
      `;
      container.appendChild(table);

      const tbody = table.querySelector('tbody');

      // Fill table rows
      states[state].forEach(item => {
        const latitude = item.latitude === null ? "Josh will provide soon" : item.latitude;
        const longitude = item.longitude === null ? "Josh will provide soon" : item.longitude;
        const height_m = item.height_m === null ? "Josh will provide soon" : item.height_m;
        const height_ft = item.height_ft === null ? "Josh will provide soon" : item.height_ft;
        const what3words = item.what3words || "Josh will provide soon";

        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${item.municipality}</td>
          <td>${item.name}</td>
          <td>${latitude}</td>
          <td>${longitude}</td>
          <td>${height_m}</td>
          <td>${height_ft}</td>
          <td><a href="https://what3words.com/${what3words}" target="_blank">${what3words}</a></td>
          <td><a href="${item.photos_link}" target="_blank">Photos</a></td>
        `;
        tbody.appendChild(row);
      });
    });
  });
</script>
